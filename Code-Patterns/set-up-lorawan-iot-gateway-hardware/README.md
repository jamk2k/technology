# LoRaWAN ネットワークを使用した長距離対応 IoT システムのハードウェア・プラットフォームをセットアップする

### Raspberry Pi、センサー、マイクロコントローラー、Watson IoT Platform を構成して、長距離対応 IoT システムを構築する

English version: https://developer.ibm.com/patterns/set-up-lorawan-iot-gateway-hardware
  ソースコード: 'https://github.com/IBM/smart-city-gateway/'

###### 最新の英語版コンテンツは上記URLを参照してください。
last_updated: 2018-10-08

 
## 概要

[The Things Network](https://www.thethingsnetwork.org/) の提供している LoRaWAN ネットワークを利用するハードウェア・プラットフォームをセットアップする方法を学んでください。このコード・パターンで説明しているのは、LoRaWAN ネットワーキングによってリソースに制約がある複数のデバイスをワイヤレスでつなげ、これらのデバイスから IoT プロジェクト用のデータを物理層またはネットワーク層で収集した後、そのデータを Watson IoT Platform にパブリッシュする方法です。

## 説明

LoRaWAN は、モノのインターネットを対象に設計された、長距離 (最適な条件では最大 10km) 対応のワイヤレス・ネットワーク・プロトコルです。このプロトコルを使用すれば、デバイスが互いに通信する際に必要となるバッテリー残量が最小限になります。長距離対応の LoRaWAN を使用することで、スマート・パーキング構造、農業関連のモニタリング、気象条件のトラッキング、資産のトラッキングといった大規模なプロジェクトのデプロイメントが可能になります。

各 LoRa ネットワークは、「ゲートウェイ」と 1 つ以上の「ノード」で構成されます。LoRa ネットワークでは、各ノードがゲートウェイと直接通信するスター型トポロジーが採用されています。したがって、ノードごとのゲートウェイ接続を使用してデータを送受信できます。ゲートウェイでは、デバイスから受信したデータを処理できるよう、データを読み取り可能な形式に変換してから IoT プラットフォームに送信することができます。

このパターンを完了すると、以下の方法がわかるようになります。

* LoRaWAN ゲートウェイとして機能するハードウェアを追加して Raspberry Pi をアセンブルする
* LoRaWAN ネットワークを使用した IoT またはスマート・シティーのセットアップに最適なセンサーを判断する
* LoRaWAN をサポートするようにマイクロコントローラーを構成する。この例でのマイクロコントローラーは、接続されたセンサーからデータを収集し、LoRa パケットを使用して、収集したデータをゲートウェイにワイヤレスで送信するハードウェアです。このパターンではマイクロコントローラーとして Adafruit LoRa の「Feather」を使用しますが、Arduino Uno や MakerFocus LoRa ボードなどの別のボードを使用することもできます。
* LoRaWan パケットをゲートウェイから Watson IoT Platform に転送する
* Watson IoT Platform (または React Web アプリケーション) 内でデータを視覚化する
* センサー・データをデータベース内に維持する
* データを分析アルゴリズムや予測アルゴリズムに取り込む

## フロー

![フロー](../../images/lorawan-arch-diagram.png)

1. LoRaWAN のエンド・ノードに電源が入り、センサーから値がサンプリングされます。そのデータがゲートウェイに送信されます。このプロセスは、ユーザーが設定する間隔で繰り返されます。
2. ゲートウェイが LoRa パケットを受信して「The Things Network」(TTN) に転送します。
3. TTN が LoRa パケットを処理し、パケットが認証済みデバイスから送信されたものであることを確認します。
4. ゲートウェイが TTN MQTT ブローカーから JSON オブジェクトを受信します。この JSON オブジェクトに、LoRa ペイロードが格納されています。
5. ゲートウェイが JSON オブジェクト内の LoRa ペイロードを (Base64 から整数/プレーン・テキストに) デコードします。この更新後の JSON オブジェクトを、Watson IoT Platform にパブリッシュします。
6. Watson IoT Platform が JSON を受信し、ダッシュボードをセンサー・データで更新するとともに、センサー・データを Cloudant Database 内に維持します。

## 手順

このコード・パターンに取り組む準備はできましたか？アプリケーションを起動して使用する方法について詳しくは、[README ファイル](https://github.com/IBM/smart-city-gateway/blob/master/README.md)を参照してください。
