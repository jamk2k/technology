# Mongoose と MongoDB を使用してアプリのデータを提供する

### Mongoose で MongoDB に接続し、Express で API を作成した Node.js 地図サーバー・アプリを構築する

English version: https://developer.ibm.com/patterns/use-mongoose-and-mongodb-to-serve-app-data
  ソースコード: https://github.com/IBM/kubernetes-mongoose

###### 最新の英語版コンテンツは上記URLを参照してください。
last_updated: 2018-04-08

 ## 概要

MongoDB データを処理するには詳細な検証およびビジネス・ロジックを作成しなければならないため、多くの時間と労力を要することになりがちです。けれどもオブジェクト・データ・モデリング・ライブラリーの Mongoose を使用すれば、データ・リレーションシップの管理も、MongoDB オブジェクトのスキーマ検証も容易に行うことができます。このコード・パターンでは、ドキュメントを読み取って更新できるよう、Mongoose を利用して MongoDB データベースに接続する方法を説明します。

## 説明

MongoDB を使用する場合、Mongoose は簡単にデータをモデル化する手段になります。Mongoose で MongoDB データベースに接続すれば、データベース内のドキュメントの作成、読み取り、更新、または削除処理を実行する Node.js アプリを構成することができます。これらのデータベース処理に対応する RESTful API を短時間で簡単に作成するには、Express フレームワークが役立ちます。

このコード・パターンでは、データベースにデータを保管する地図サーバー・アプリケーションを構成するのに便利な方法を説明します。このアプリケーションは Kubernetes プラットフォーム内にデプロイすることになります。

このパターンは、アプリケーション全体の一部を構成するものです。最終的なアプリケーションは、ブース、イベント、ビーコンなどの (イベントのヒート・マップを生成するための) データを保管する地図サーバーです。地図サーバーは、ユーザー対応ダッシュボードのバックエンドとして使用されます。ダッシュボードではサーバーの構成済み API から返されたデータを視覚化し、地図または平面図をユーザーに表示します。この地図サーバーは iOS アプリ内で屋内地図を生成するためにも使用されます。

このコード・パターンをひと通り完了すると、以下の方法がわかるようになります。

* NodeJS を使用して Mongoose を実装する
* データベース処理を実行する RESTful API を作成する

アプリ内で Mongoose の柔軟性と利便性を活用する準備ができれば、それが皆さんの出発点となります。

## フロー

![フロー](../../images/arch-map-server-mongoose.png)

1. ユーザーが MongoDB データベースをセットアップします。このパターンでは Compose for MongoDB を利用します。
2. ユーザーが、アプリケーション内に設定されたモデルのスキーマと一致するモック・データを追加します。
3. ユーザーが API を使用して、デプロイ済みアプリとやり取りします。ユーザーは SVG 形式または PDF 形式の屋内地図を表示できます。

## 手順

このパターンの詳細な手順については、[README](https://github.com/IBM/kubernetes-mongoose) を参照してください。手順の概要は以下のとおりです。

1. リポジトリーを複製します。
2. IBM Cloud を利用して Compose for MongoDB サービスを作成します。
3. イメージをビルドします。
4. デプロイメント・ファイルを構成します。
5. アプリケーションをデプロイします。
6. モック・データを生成します。
7. API リクエストを実行します。
