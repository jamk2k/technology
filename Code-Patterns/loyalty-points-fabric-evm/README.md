# Hyperledger Fabric Ethereum 仮想マシンを使用して、ロイヤルティー・ポイント用ブロックチェーン・アプリを作成する

### EVM を使用して Fabric をローカルにデプロイし、Node.js Web アプリを介してスマート・コントラクトとやり取りするプロキシーを作成する

English version: https://developer.ibm.com/patterns/loyalty-points-fabric-evm
  ソースコード: https://github.com/IBM/loyalty-points-evm-fabric

###### 最新の英語版コンテンツは上記URLを参照してください。
last_updated:	2018-11-14

 
## 概要

Hyperledger Fabric では、モジュール式アーキテクチャーとコンセンサス・プロトコルを使用して、ネイティブの暗号通貨を必要としないブロックチェーン・ネットワークを構築できます。Ethereum は、分散型アプリケーション用のスマート・コントラクトを作成し、ライブラリーを使ってスマート・コントラクトとやり取りするための構造化された革新的プラットフォームです。Ethereum では、例えば Ethereum の Solidity を利用してスマート・コントラクトを作成し、web3.js ライブラリーを使用してスマート・コントラクトとやり取りできます。このコード・パターンでは、これらのツールを Hyperledger Fabric ネットワークを使用したブロックチェーン・ネットワークで利用する方法を説明します。Ethereum 仮想マシン (EVM) を使用して Fabric をローカルにデプロイする手順、そして Node.js Web アプリケーションを介してスマート・コントラクトとやり取りするプロキシーを作成する手順を学んでください。

## 説明

このコード・パターンで説明する [Hyperledger Fabric EVM](https://github.com/hyperledger/fabric-chaincode-evm) では、開発者が [Solidity](https://solidity.readthedocs.io/en/v0.4.25/) などの EVM スマート・コントラクト言語を使用してブロックチェーン・アプリケーションを作成できます。Solidity で作成したスマート・コントラクトは、Fabric ピア上で実行される EVM チェーンコードにデプロイします。このパターンの使用ケースでは、ロイヤルティー・ポイント・プログラムのメンバーまたはパートナーとしてのユーザーが、Fabric ネットワークのプロキシーとしての Fab3 を介してスマート・コントラクトとやり取りする仕組みを説明します。Fab3 では [Ethereum web3.js](https://web3js.readthedocs.io/en/v1.2.1/) ライブラリーを使用して、Fabric ネットワーク内の EVM とやり取りできます。

このコード・パターンで対象としているのは、Hyperledger Fabric EVM を使用して Solidity スマート・コントラクトを統合したブロックチェーン・アプリケーションを作成することを目指している開発者です。このパターンを完了すると、以下の方法がわかるようになります。

* EVM チェーンコードを使用した Hyperledger Fabric インスタンスをローカルにデプロイする
* Fab3 インスタンスを起動して Fabric ネットワークとやり取りする
* web3 ライブラリーを使用して、Solidity スマート・コントラクトとやり取りする
* web3 ライブラリーを使用して、Node.js ブロックチェーン Web アプリケーションを構築する

## フロー

![フロー](../../images/flow-1153-v3.png)

1. ロイヤルティー・ポイント・プログラムのパートナーが自分のアカウント用の fab プロキシーを使用してブロックチェーン・ネットワークにアクセスします。最初のパートナーがスマート・コントラクトをブロックチェーン・ネットワークにデプロイします。
1. パートナーがプロキシーを介して Web アプリケーションにアクセスし、ネットワークに登録します。登録後は、すべてのトランザクションを表示できるようになります。
1. ロイヤルティー・ポイント・プログラムのメンバーが自分のアカウント用の fab プロキシーを使用してブロックチェーン・ネットワークにアクセスします。
1. メンバーがプロキシーを介して Web アプリケーションにアクセスし、ネットワークに登録します。登録後は、ネットワーク上のパートナーからポイントを獲得するためのトランザクションやポイントを交換するためのトランザクションを行ったり、すべてのトランザクションを表示したりできます。
1. Web アプリケーションでは Ethereum web3.js ライブラリーを使用してスマート・コントラクトを実行します。
1. ピア上にインストールされた EVM チェーンコードにより、スマート・コントラクトの実行結果がネットワーク上で更新されます。

## 手順

詳細な手順については、[README](https://github.com/IBM/loyalty-points-evm-fabric/blob/master/README.md) を参照してください。手順の概要は以下のとおりです。

1. EVM チェーンコードを使用した Hyperledger Fabric インスタンスをローカルにデプロイします。
1. Fab3 をセットアップします。
1. スマート・コントラクトをデプロイします。
1. 2つ目の Fab3 をセットアップします。
1. Web アプリケーションを実行します。
