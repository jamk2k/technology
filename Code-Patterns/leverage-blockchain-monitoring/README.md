# ブロックチェーン・モニタリングを利用する

### React および Node.js を使用してブロックチェーン・モニタリング・アプリを作成し、Hyperledger Fabric SDK を使用してサプライ・チェーンの資産を追跡するする

English version: https://developer.ibm.com/patterns/leverage-blockchain-monitoring
  ソースコード: https://github.com/IBM/monitoring_ui

###### 最新の英語版コンテンツは上記URLを参照してください。
last_updated: 2018-08-05

 ## 概要

このコード・パターンでは、IoT 資産がサプライ・チェーンを移動する間、オペレーターがそのトランザクションの進行状況をモニタリングするために使用できる UI を備えたアプリケーションを作成します。進行状況をモニタリングするために、Hyperledger Fabric SDK を使用してブロックチェーン・サービスをクエリーします。Hyperledger Fabric SDK を使用することで、オペレーターが個々のブロックとそのトランザクションを表示できるだけでなく、新しい資産の登録機能や資産のプロパティーの表示/更新機能を備えた UI を使用してチェーンコードを操作できるようになります。

## 説明

IoT が最も革新的で有用な形のテクノロジーの 1 つとなっている中、IoT デバイスを不正侵入から保護する方法を知りたいと思ったことはありませんか？破損や誤削除などによるデータ損失を防ぐ方法については？あるいは、セキュリティーを危険にさらすことなく、利害関係者が IoT デバイスの状態を確認できるようにする方法を考えたことはありますか？

この開発者コード・パターンでは、React、Node.js、そして Hyperledger Fabric SDK を使用したブロックチェーン・モニタリング・アプリケーションの例を紹介します。この統合により、ユーザーはブロックチェーンに対するアクションを簡単に実行して、資産の状態をモニタリングすることが可能になります。

このコード・パターンを完了すると、以下の方法がわかるようになります。

* Hyperledger ブロックチェーン・ネットワークを IBM Cloud 上にデプロイする
* Hyperledger Node SDK を使用して管理クライアントを作成し、登録する
* 資産の更新/クエリーを処理するスマート・コントラクトをデプロイして初期化する
* 資産のプロパティーを記述するスキーマを作成する
* UI を使用してブロックチェーン・トランザクションのモニタリングおよびトランザクションの提案を行う
* IBM Watson™ IoT Platform を統合し、MQTT または HTTP を使用して登録済み IoT デバイスから資産の更新を直接受信する

## フロー
![フロー](../../images/arch-interacting-blockchain-network.png)

1. ブロックチェーン・レジャー内の資産を作成、読み取り、更新、または削除するリクエストが送信されます。このリクエストは、ユーザーがモニタリング UI ブラウザーを使用して手作業で送信することも、MQTT メッセージを Watson IoT Platform にパブリッシュする IoT デバイス (NFC/バーコード・スキャナーなど) から送信することもできます。

1. Express.js バックエンドが、CRUD リクエストを JSON-RPC オブジェクト (以下を参照) にフォーマット化し、トランザクション案として Hyperledger ピアに送信します。

```
{
    jsonrpc: '2.0',
    method: 'invoke',
    params: {
        type: 1,
        chaincodeID: {
            name: 'simple_contract'
        },
        ctorMsg: {
            function: 'createAsset',
            args: '["assetID",
  {"carrier": "Port of Long Beach",
  "longitude":"33.754185", "latitude":
  "-118.216458", "temperature": "44 F"}]'
        },
        secureContext: 'kkbankol@us.ibm.com'
    },
    id: 5
}
```

1. ピアは「承認」サービスを利用して、関連するスマート・コントラクトに照らし合わせてトランザクション案をシミュレートします。この承認サービスにより、レジャーの現在の状態であれば、トランザクションを実行可能であるということが確認されます。無効なトランザクション案の例としては、既存の資産を作成するトランザクションや、存在しない資産の状態をクエリーするトランザクションなど挙げられます。

1. シミュレーションが成功すると、トランザクション案にピアのエンドーサーが「署名」します。

1. 署名されたトランザクションが順序付けサービスに転送され、このサービスによってトランザクションが実行されて結果がレジャーに取り込まれます。

1. モニタリング UI が自動更新し、レスポンスのペイロードとブロックチェーン列に含まれるトランザクション結果と更新済みレジャーを表示します。
