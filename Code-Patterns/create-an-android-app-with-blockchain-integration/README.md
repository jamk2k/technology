# ブロックチェーンを統合した Android アプリを作成する

### Android と Kubernetes を使用して、ブロックチェーン対応の健康・フィットネス・アプリを作成する

English version: https://developer.ibm.com/patterns/./create-an-android-app-with-blockchain-integration
  ソースコード: https://github.com/IBM/android-kubernetes-blockchain

###### 最新の英語版コンテンツは上記URLを参照してください。
last_updated: 2018-07-25

 ## 概要

健康とフィットネスに気を配っている人々の多くは、モバイル・アプリケーションを使用して自分のデータを追跡しています。こうしたアプリの中には、特定の目標を達成した時点、またはタスクを完了した時点でご褒美を与えるものもあります。アプリケーション開発者に提供するデータについて意識する人々が多くなっていることから、私たちは Hyperledger Fabric (ブロックチェーン・フレームワークの実装) を使用して、個人のデータとトランザクションを匿名化し、セキュリティーを確保しています。このコード・パターンで作成する Android アプリは、ユーザーの歩数を記録し、歩数に応じて、記念品と交換できる「Kubecoin」をユーザーに与えます。

## 説明

最近の開発には、スケーラビリティー、回復力、そして十分な管理が欠かせません。このことから、私たちは Android アプリのバックエンドとして Kubernetes を使用することにしました。また、アプリでブロックチェーン機能を使えるよう、Hyperledger Fabric を使用することにしました。さらに、データ・ストレージには MongoDB を使用し、ブロックチェーン・リクエストを最適化するために RabbitMQ と Redis を使用しています。

このコード・パターンは、アプリで個人データを匿名化してユーザーのセキュリティーを確保することを目指している開発者を対象としています。このようなアプリでユーザーが自分のプライバシーを管理しやすくすれば、ユーザーは自信を持ってそのアプリを使用するようになります。開発者はこのパターンを拡張して、別のプラットフォームのバックエンドを使用することもできます。

この Android アプリケーションは、KubeCon Europe 2018 で使用されました。

このコード・パターンを完了すると、以下の方法がわかるようになります。

* ネイティブ Android アプリを作成し、Google Fit を使用してアプリの歩数データを記録する
* ブロックチェーン・ネットワークを Kubernetes 内にデプロイする
* Android アプリにブロックチェーン・ネットワークを統合する

## フロー

![フロー]](./images/Kubecoin-arch-diagram2.png)

1. モバイル・アプリがブロックチェーン・ネットワークと相互作用するために使用する手段は、REST API です。API がリクエストに確認応答し、モバイル・アプリに固有のキー (ランダムな数値と文字) を渡します。アプリはこのキーを使用して、ブロックチェーンからレスポンスを取得することになります。
1. API はリクエストをそのまま RabbitMQ 内のキューに保管します。このキューにはユーザー (Fitcoin org) 用と販売者 (Shop org) 用の 2 つのチャネルがあります。リクエストは、ユーザーの登録、ブロックチェーン・ネットワーク内のデータのクエリー、トランザクションの呼び出しまたは実行のいずれかを目的としたものです。
1. 実行ワーカーは Hyperledger Fabric Node.js SDK を使用してリクエストを行います。これらのワーカーは RabbitMQ からのリクエストを listen しています。
1. 実行ワーカーがリクエストをブロックチェーン・ネットワークに送信すると、ネットワーク内でリクエストが処理されます。ブロックチェーン・ネットワークでは NFS を使用して、レジャーおよび状態データベースを維持します。
1. 実行ワーカーはレスポンスを受け取ると、ステップ 1 で渡された固有のキーと一緒にそのレスポンスを Redis データベース内に維持します。
1. モバイル・アプリは引き続き、ブロックチェーンからのレスポンス結果を待機します。これらのレスポンスは Redis データベース内にあるはずなので、モバイル・アプリは固有のキーを使用して Redis データベースをクエリーします。
1. ユーザーの作成、ユーザーの歩数の更新には、Registration マイクロサービスが利用されます。ブロックチェーン・ネットワークがユーザーを登録し、そのユーザーにユーザー ID を割り当てると、Registration マイクロサービスはそのユーザー ID を使用してユーザーを作成します。
1. ユーザーが登録されると、そのユーザーのランダムな名前とアバターを生成するために、IBM Cloud Function が呼び出されます。
1. マイクロサービスからのユーザー・データ (ユーザーの歩数、名前、アバター) とモバイル・アセット (モバイル・アプリの最初のビューに表示されるブックレット/記事) は、MongoDB 内に維持されます。
1. Mobile Assets マイクロサービスは、MongoDB をクエリーしてモバイル・アプリの動的データを取得する際に利用されます。最初のビューに表示されるブックレットは、そのコンテンツをデータベースから取得します。
1. Leaderboard マイクロサービスは、ユーザーの順位表を取得する際に利用されます。

## 手順

このパターンの詳細な手順については、[README](https://github.com/IBM/android-kubernetes-blockchain/blob/master/README.md) を参照してください。手順の概要は以下のとおりです。

1. このパターンのリポジトリーを複製します。
1. IBM Cloud サービスを作成します。
1. ブロックチェーン・ネットワークを構成します。
1. ブロックチェーン・ネットワークを Kubernetes 内にデプロイします。
1. マイクロサービスを Kubernetes 内にデプロイして構成します。
1. Kubernetes Ingress を使用してバックエンドを公開します。
1. Android アプリを構成します。
1. Android アプリをテストとします。
